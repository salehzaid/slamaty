# โ ุชู ุฅููุงู ุชุทููุฑ ุขููุฉ CAPA

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุจูุฌุงุญ ุชุทููุฑ ูุชุญุณูู ุขููุฉ ุฅูุดุงุก ุงูุฎุทุท ุงูุชุตุญูุญูุฉ (CAPA) ููุนูุงุตุฑ ุบูุฑ ุงูููุชููุฉ ุจูุง ูุชูุงุดู ูุน ุงููุชุทูุจุงุช:
- โ ุนุฏู ุฅูุดุงุก CAPA ุชููุงุฆูุงู
- โ ุญูุธ ุนูุงูุฉ "needs CAPA" ุนูู ุงูุนูุตุฑ
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุงุถุญุฉ ูุจุณูุทุฉ
- โ ูุธุงู ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ
- โ CAPA ุจุณูุท ุจุฏูู workflow ููุงููุงุช ูุนูุฏ

---

## ๐ฏ ุงูุชุญุณููุงุช ุงููููุฐุฉ

### 1๏ธโฃ Backend (ุงูุฎูููุฉ)

#### โ ุฅุถุงูุฉ Endpoints ุฌุฏูุฏุฉ

**ููู: `backend/crud.py`**
- ุฏุงูุฉ `get_evaluation_items_needing_capa(db, round_id)` - ุชุฌูุจ ุฌููุน ุงูุนูุงุตุฑ ุงููุนูููุฉ ูู needs_capa

**ููู: `backend/main.py`**
```python
GET /api/rounds/{round_id}/items-needing-capa
POST /api/evaluation-results/{result_id}/mark-needs-capa
```

#### โ ูุธุงู ุงูุฅุดุนุงุฑุงุช

**ููู: `backend/models_updated.py`**
- ุฅุถุงูุฉ `CAPA_CREATED` ู `EVALUATION_NEEDS_CAPA` ูู NotificationType

**ููู: `backend/notification_service.py`**
- ุฏุงูุฉ `send_capa_created_notification()` - ุชุฑุณู ุฅุดุนุงุฑุงุช ููููุนููู ููุฏูุฑู ุงูุฌูุฏุฉ

**ููู: `backend/capa_router.py`**
- ุฏูุฌ ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ ุนูุฏ ุฅูุดุงุก CAPA
- ุฅุดุนุงุฑ ููุฑู ูููุณุชุฎุฏู ุงูููุนููู
- ุฅุดุนุงุฑ ูุฌููุน ูุฏูุฑู ุงูุฌูุฏุฉ

---

### 2๏ธโฃ Frontend (ุงููุงุฌูุฉ ุงูุฃูุงููุฉ)

#### โ ูููุฐุฌ ุงูุชูููู ุงููุญุณูู
**ููู: `src/components/forms/EvaluateRoundForm.tsx`**

**ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**
1. **Checkbox "ูุญุชุงุฌ ุฎุทุฉ ุชุตุญูุญูุฉ"**
   - ูุธูุฑ ุชููุงุฆูุงู ููุนูุงุตุฑ ุบูุฑ ุงูููุชููุฉ (not_applied ุฃู partial)
   - ุชูุนูู/ุฅูุบุงุก ุชูุนูู ุจุณูุท

2. **ุญูู ููุงุญุธุฉ CAPA**
   - ูุธูุฑ ุนูุฏ ุชูุนูู checkbox
   - ูุณูุญ ุจุฅุถุงูุฉ ุชูุงุตูู ุนู ุงูุฎุทุฉ ุงููุทููุจุฉ

3. **ุฒุฑ "ุฅูุดุงุก ุฎุทุฉ ุชุตุญูุญูุฉ ุงูุขู"**
   - ูุงุถุญ ููุจุงุดุฑ ุจููู ูููุฒ (ุฃุตูุฑ/ุจุฑุชูุงูู)
   - ูุนูู ุจุฏูู ุดุฑุท #capa

4. **ูุคุดุฑุงุช ุจุตุฑูุฉ**
   - ููู ุฎูููุฉ ูููุฒ (bg-amber-50) ุนูุฏ ุชูุนูู needs CAPA
   - ุฃููููุฉ ุชุญุฐูุฑ (AlertTriangle) ุจุฌุงูุจ checkbox
   - Badge ูู ุฑุฃุณ ุงูุตูุญุฉ ูุนุฑุถ ุนุฏุฏ ุงูุนูุงุตุฑ ุงูุชู ุชุญุชุงุฌ CAPA

5. **ุฏุนู Legacy**
   - ูุง ูุฒุงู ูุฏุนู #capa ูู ุงูุชุนูููุงุช ููุชูุงูู

#### โ ููุญุฉ CAPA ุงููุญุณููุฉ
**ููู: `src/components/pages/EnhancedCapaManagement.tsx`**

**ุงูุชุญุณููุงุช:**
1. **ุจุทุงูุงุช ุฃูููุฉ ููุนูุงุตุฑ**
   - ุชุตููู modern ูุน hover effects
   - ุฃููููุฉ ุชุญุฐูุฑ ุจุฌุงูุจ ูู ุนูุตุฑ

2. **Badges ููููุฉ**
   - ๐ด ุฃุญูุฑ: ุบูุฑ ูุทุจู (not_applied)
   - ๐ก ุฃุตูุฑ: ูุทุจู ุฌุฒุฆูุงู (partial)
   - ุนุฑุถ item_code ู category_name

3. **ุนุฑุถ ููุงุญุธุฉ CAPA**
   - ุฎูููุฉ ุตูุฑุงุก ูููุฒุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
   - ุณูููุฉ ุงููุฑุงุกุฉ

4. **ุฒุฑ ุฅูุดุงุก ูุญุณูู**
   - ููู ูููุฒ (bg-amber-600)
   - ุฃููููุฉ FileText ุจุฌุงูุจ ุงููุต

#### โ API Calls ุฌุฏูุฏุฉ
**ููู: `src/lib/api.ts`**
```typescript
getItemsNeedingCapa(roundId: number)
markEvaluationNeedsCapa(resultId: number, needsCapa: boolean, capaNote: string)
```

---

## ๐งช ุฏููู ุงูุงุฎุชุจุงุฑ ุงููุงูู

### ุงูุฎุทูุฉ 1: ุชูููู ุฌููุฉ
1. ุงูุชูู ุฅูู ุตูุญุฉ "ุงูุฌููุงุช"
2. ุงูุชุญ ุฌููุฉ ููุชูููู
3. ูููู ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู ูู **"ุบูุฑ ูุทุจู"** ุฃู **"ูุทุจู ุฌุฒุฆูุงู"**

### ุงูุฎุทูุฉ 2: ุชุนููู ุงูุนูุตุฑ ูู needs CAPA
1. ุงุจุญุซ ุนู ูุณู **"ูุญุชุงุฌ ุฎุทุฉ ุชุตุญูุญูุฉ (CAPA)"** ุฃุณูู ุญูู ุงูููุงุญุธุงุช
2. ูุนูู **checkbox** "ูุญุชุงุฌ ุฎุทุฉ ุชุตุญูุญูุฉ"
3. ูุงุญุธ ุงูุชุบููุฑุงุช:
   - โ ุงูุฎูููุฉ ุชุชุญูู ูููู ุฃุตูุฑ/ุจุฑุชูุงูู
   - โ ูุธูุฑ ุญูู "ููุงุญุธุฉ ุฎุงุตุฉ ุจุงูุฎุทุฉ ุงูุชุตุญูุญูุฉ"
   - โ ูุธูุฑ ุฒุฑ "ุฅูุดุงุก ุฎุทุฉ ุชุตุญูุญูุฉ ุงูุขู"

### ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ููุงุญุธุฉ CAPA (ุงุฎุชูุงุฑู)
1. ูู ุญูู "ููุงุญุธุฉ ุฎุงุตุฉ ุจุงูุฎุทุฉ ุงูุชุตุญูุญูุฉ"
2. ุงูุชุจ ุชูุงุตูู ุนู ุงูุฎุทุฉ ุงููุทููุจุฉ
3. ูุซุงู: "ูุญุชุงุฌ ุชุฏุฑูุจ ุงูููุธููู ุนูู ุงูุจุฑูุชูููู ุงูุฌุฏูุฏ"

### ุงูุฎุทูุฉ 4: ุฅูุดุงุก CAPA
**ุทุฑููุฉ 1: ุฅูุดุงุก ููุฑู**
1. ุงุถุบุท ุฒุฑ **"ุฅูุดุงุก ุฎุทุฉ ุชุตุญูุญูุฉ ุงูุขู"**
2. ุฃููุฏ ุงูุฅูุดุงุก
3. ุณุชุธูุฑ ุฑุณุงูุฉ ูุฌุงุญ โ

**ุทุฑููุฉ 2: ุญูุธ ุงูุชูููู ุฃููุงู**
1. ุงุถุบุท "ุญูุธ ูุณูุฏุฉ" ุฃู "ุฅุฑุณุงู ุงูุชูููู"
2. ุงูุชูู ุฅูู ุตูุญุฉ **"ุฅุฏุงุฑุฉ CAPA"** (`/capa`)
3. ุณุชุฌุฏ ููุญุฉ "ุนูุงุตุฑ ุบูุฑ ููุชููุฉ ูู ุงูุชูููู"

### ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ุงูุฅุดุนุงุฑุงุช
1. **ูููุณุชุฎุฏู ุงูููุนููู:**
   - ุงูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช
   - ุณุชุฌุฏ ุฅุดุนุงุฑ "ุฎุทุฉ ุชุตุญูุญูุฉ ุฌุฏูุฏุฉ ุชู ุฅูุดุงุคูุง"

2. **ููุฏูุฑู ุงูุฌูุฏุฉ:**
   - ูุชูููู ุฅุดุนุงุฑ "ุฎุทุฉ ุชุตุญูุญูุฉ ุฌุฏูุฏุฉ"
   - ุจุฏูู ุฅุฑุณุงู email (ูุชุฌูุจ ุงูุฅุฒุนุงุฌ)

### ุงูุฎุทูุฉ 6: ุงูุชุญูู ูู Badge ุงูุนุฏุงุฏ
1. ูู ุฑุฃุณ ุตูุญุฉ ุงูุชูููู
2. ูุงุญุธ Badge ุจููู ุฃุตูุฑ:
   ```
   ๐บ ูุญุชุงุฌ CAPA: 2
   ```
   (ูุนุฑุถ ุนุฏุฏ ุงูุนูุงุตุฑ ุงููุนูููุฉ)

---

## ๐ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ ุงูุชุตููู
- **UX ุจุณูุท ููุงุถุญ**: ูุง ุญุงุฌุฉ ููุชุงุจุฉ #capa
- **ุฃููุงู ูููุฒุฉ**: ุฃุตูุฑ/ุจุฑุชูุงูู ููุนูุงุตุฑ ุงูุชู ุชุญุชุงุฌ CAPA
- **ุฃููููุงุช ูุงุถุญุฉ**: AlertTriangle, FileText
- **Responsive**: ูุนูู ุนูู ุฌููุน ุงูุดุงุดุงุช

### โ ุงููุธุงุฆู
- **ูุง ุฅูุดุงุก ุชููุงุฆู**: ูุญูุธ ุนูุงูุฉ needs_capa ููุท
- **ุฅุดุนุงุฑุงุช ููุฑูุฉ**: ููููุนููู ููุฏูุฑู ุงูุฌูุฏุฉ
- **CAPA ุจุณูุท**: ุจุฏูู workflow ููุงููุงุช ูุนูุฏ
- **ุฏุนู Legacy**: ูุง ูุฒุงู ูุฏุนู #capa

### โ ุงูุจูุงูุงุช
- ุญูู `needs_capa` ูู ุฌุฏูู `evaluation_results`
- ุญูู `capa_note` ูููุงุญุธุงุช CAPA
- ุฑุจุท ุชููุงุฆู ุจู evaluation_item_id

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุตูุงุญูุงุช:**
   - ููุท `super_admin` ู `quality_manager` ู `department_head` ูููููู ุฅูุดุงุก CAPA

2. **ุงูุชูุงูู:**
   - ุฌููุน ุงูุชุบููุฑุงุช ูุชูุงููุฉ ูุน ุงูููุฏ ุงูููุฌูุฏ
   - ูุง ุชุชุนุงุฑุถ ูุน ุฃู ููุฒุฉ ุญุงููุฉ

3. **ุงูุฃุฏุงุก:**
   - ุงูุงุณุชุนูุงูุงุช ูุญุณููุฉ ูููููุฑุณุฉ
   - ูุง ุชุฃุซูุฑ ุนูู ุณุฑุนุฉ ุงููุธุงู

4. **ุงูุฐุงูุฑุฉ:**
   - ุชุทุจูู ูุงูู ูููุชุทูุจุงุช ุงููุญููุธุฉ ูู ุงูุฐุงูุฑุฉ
   - ุนุฏู ุฅูุดุงุก CAPA ุชููุงุฆูุงู โ
   - CAPA ุจุณูุท ุจุฏูู workflow โ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

ุฅุฐุง ุฃุฑุฏุช ุชุญุณููุงุช ุฅุถุงููุฉ ูู ุงููุณุชูุจู:

1. **Dashboard ูุญุณูู:**
   - ุจุทุงูุฉ "ุนูุงุตุฑ ุชุญุชุงุฌ CAPA" ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
   - ุฅุญุตุงุฆูุงุช ููุตูุฉ

2. **ุชูุงุฑูุฑ:**
   - ุชูุฑูุฑ ุจุฌููุน ุงูุนูุงุตุฑ ุงูุชู ุชุญุชุงุฌ CAPA
   - ุชุตุฏูุฑ Excel/PDF

3. **ุชุฐููุฑุงุช:**
   - ุชุฐููุฑ ุชููุงุฆู ููุนูุงุตุฑ ุงูุชู ุชุญุชุงุฌ CAPA ููุชุฑุฉ ุทูููุฉ

4. **Workflow ูุจุณูุท:**
   - ุญุงูุฉ "draft" ูุจู ุงููุดุฑ ุงูููุงุฆู
   - ูุฑุงุฌุนุฉ ุจุณูุทุฉ (ุงุฎุชูุงุฑู)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุชุทููุฑ ูุชุญุณูู ุขููุฉ CAPA ุจุงููุงูู! ุงูุขู ุงููุธุงู:
- โ ูุง ููุดุฆ CAPA ุชููุงุฆูุงู
- โ ูุญูุธ ุนูุงูุฉ needs_capa ุนูู ุงูุนูุงุตุฑ
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ูุงุถุญุฉ ูุจุณูุทุฉ
- โ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ููููุนููู ููุฏูุฑู ุงูุฌูุฏุฉ
- โ CAPA ุจุณูุท ุจุฏูู ุชุนููุฏุงุช

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐**

---

## ๐ ููุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ ุฃู ุงุญุชุฌุช ูุณุงุนุฏุฉ:
1. ุชุญูู ูู console.log ูู ุงููุชุตูุญ
2. ุชุญูู ูู backend logs
3. ุฑุงุฌุน ูุฐุง ุงูููู ููุชุนูููุงุช

ุชู ุงูุชุทููุฑ ูุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ โจ

